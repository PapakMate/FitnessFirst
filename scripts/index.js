const data = {
    "website": "Roba",
    "categories": [
        {
            "name": "Patike",
            "image": "images/shoes.jpg",
            "products": [
                {
                    "name": "Plave Nike", "image": "images/1.jpg",
                    "id": 1, "cnt": 0
                },
                {
                    "name": "Bijele Nike", "image": "images/2.jpg",
                    "id": 2, "cnt": 0
                },
                {
                    "name": "Žute Nike", "image": "images/3.jpg",
                    "id": 3, "cnt": 0
                },
                {
                    "name": "Sive krpene", "image": "images/4.jpg",
                    "id": 4, "cnt": 0
                },
                {
                    "name": "AirForce", "image": "images/5.jpg",
                    "id": 5, "cnt": 0
                }
            ]
        },
        {
            "name": "Hlače",
            "image": "images/pants.jpg",
            "products": [
                {
                    "name": "Bijele hlače", "image": "images/6.jpg",
                    "id": 6, "cnt": 0
                },
                {
                    "name": "Jeans plave", "image": "images/7.jpg",
                    "id": 7, "cnt": 0
                },
                {
                    "name": "Jeans svijetle", "image": "images/8.jpg",
                    "id": 8, "cnt": 0
                },
                {
                    "name": "Jeans tamne", "image": "images/9.jpg",
                    "id": 9, "cnt": 0
                },
                {
                    "name": "Sive hlače", "image": "images/10.jpg",
                    "id": 10, "cnt": 0
                }
            ]
        },
        {
            "name": "Košulje",
            "image": "images/shirt.jpg",
            "products": [
                {
                    "name": "Svijetla košulja", "image": "images/11.jpg",
                    "id": 11, "cnt": 0
                },
                {
                    "name": "Karirano crvena", "image": "images/12.jpg",
                    "id": 12, "cnt": 0
                },
                {
                    "name": "Sidrana košulja", "image": "images/13.jpg",
                    "id": 13, "cnt": 0
                },
                {
                    "name": "Karirano siva", "image": "images/14.jpg",
                    "id": 14, "cnt": 0
                },
                {
                    "name": "Duga košulja", "image": "images/15.jpg",
                    "id": 15, "cnt": 0
                }
            ]
        },
        {
            "name": "Majice",
            "image": "images/tshirt.jpg",
            "products": [
                {
                    "name": "House", "image": "images/16.jpg",
                    "id": 16, "cnt": 0
                },
                {
                    "name": "Planets", "image": "images/17.jpg",
                    "id": 17, "cnt": 0
                },
                {
                    "name": "Colorful", "image": "images/18.jpg",
                    "id": 18, "cnt": 0
                },
                {
                    "name": "Pac_Man", "image": "images/19.jpg",
                    "id": 19, "cnt": 0
                },
                {
                    "name": "Play Hard", "image": "images/20.jpg",
                    "id": 20, "cnt": 0
                }
            ]
        },
        {
            "name": "Čarape",
            "image": "images/socks.jpg",
            "products": [
                {
                    "name": "Crevene čarape", "image": "images/21.jpg",
                    "id": 21, "cnt": 0
                },
                {
                    "name": "Rozaste čarape", "image": "images/22.jpg",
                    "id": 22, "cnt": 0
                },
                {
                    "name": "Plave čarape", "image": "images/23.jpg",
                    "id": 23, "cnt": 0
                },
                {
                    "name": "Roze čarape", "image": "images/24.jpg",
                    "id": 24, "cnt": 0
                },
                {
                    "name": "Sive čarape", "image": "images/25.jpg",
                    "id": 25, "cnt": 0
                }
            ]
        },
        {
            "name": "Jakete",
            "image": "images/jacket.jpg",
            "products": [
                {
                    "name": "Jeans jaketa", "image": "images/26.jpg",
                    "id": 26, "cnt": 0
                },
                {
                    "name": "Marvins jaketa", "image": "images/27.jpg",
                    "id": 27, "cnt": 0
                },
                {
                    "name": "Kožna jaketa", "image": "images/28.jpg",
                    "id": 28, "cnt": 0
                },
                {
                    "name": "Zelena jaketa", "image": "images/29.jpg",
                    "id": 29, "cnt": 0
                },
                {
                    "name": "Smeđa jaketa", "image": "images/30.jpg",
                    "id": 30, "cnt": 0
                }
            ]
        },
        {
            "name": "Naočale",
            "image": "images/sunglasses.jpg",
            "products": [
                {
                    "name": "Ray-ban naočale", "image": "images/31.jpg",
                    "id": 31, "cnt": 0
                },
                {
                    "name": "Sunčane naočale", "image": "images/32.jpg",
                    "id": 32, "cnt": 0
                },
                {
                    "name": "Ženske naočale", "image": "images/33.jpg",
                    "id": 33, "cnt": 0
                },
                {
                    "name": "Bijele naočale", "image": "images/34.jpg",
                    "id": 34, "cnt": 0
                },
                {
                    "name": "Oštre naočale", "image": "images/35.jpg",
                    "id": 35, "cnt": 0
                }
            ]
        },
        {
            "name": "Šeširi",
            "image": "images/hat.jpg",
            "products": [
                {
                    "name": "Crni šešir", "image": "images/36.jpg",
                    "id": 36, "cnt": 0
                },
                {
                    "name": "Svijetli šešir", "image": "images/37.jpg",
                    "id": 37, "cnt": 0
                },
                {
                    "name": "Bijeli šešir", "image": "images/38.jpg",
                    "id": 38, "cnt": 0
                },
                {
                    "name": "Plavi šešir", "image": "images/39.jpg",
                    "id": 39, "cnt": 0
                },
                {
                    "name": "Smeđi šešir", "image": "images/40.jpg",
                    "id": 40, "cnt": 0
                }
            ]
        },
        {
            "name": "Kape",
            "image": "images/cap.jpg",
            "products": [
                {
                    "name": "Nike kapa", "image": "images/41.jpg",
                    "id": 41, "cnt": 0
                },
                {
                    "name": "Crna kapa", "image": "images/42.jpg",
                    "id": 42, "cnt": 0
                },
                {
                    "name": "LA kapa", "image": "images/43.jpg",
                    "id": 43, "cnt": 0
                },
                {
                    "name": "UN kapa", "image": "images/44.jpg",
                    "id": 44, "cnt": 0
                },
                {
                    "name": "NY kapa", "image": "images/45.jpg",
                    "id": 45, "cnt": 0
                }
            ]
        },
        {
            "name": "Ruksaci",
            "image": "images/backpack.jpg",
            "products": [
                {
                    "name": "Crni ruksak", "image": "images/46.jpg",
                    "id": 46, "cnt": 0
                },
                {
                    "name": "Plavi ruksak", "image": "images/47.jpg",
                    "id": 47, "cnt": 0
                },
                {
                    "name": "Crveni ruksak", "image": "images/48.jpg",
                    "id": 48, "cnt": 0
                },
                {
                    "name": "Sivi ruksak", "image": "images/49.jpg",
                    "id": 49, "cnt": 0
                },
                {
                    "name": "Tamni ruksak", "image": "images/50.jpg",
                    "id": 50, "cnt": 0
                }
            ]
        }
    ]
};



// Function to dynamically display categories
function displayCategories() {
    const categoriesDiv = document.getElementById('categories');
    categoriesDiv.innerHTML = ''; // Clear previous content
  
    // Loop through the categories data and create HTML elements
    for (const category of data.categories) {
      const categoryDiv = document.createElement('div');
      categoryDiv.className = 'category';
      categoryDiv.innerHTML = `<h3>${category.name}</h3>`;
      categoryDiv.addEventListener('click', () => {
        displayProducts(category.products, category); // Call function to display products on category click
      });
      
      categoriesDiv.appendChild(categoryDiv);
    }
  }
  
  // Function to dynamically display products based on category
  function displayProducts(products, category) {
    const welcomeDiv = document.getElementById('welcome');
    welcomeDiv.innerHTML = `<img src="${category.image}" alt="${category.name}">
                            <h2>DOBRODOŠLI!</h2>`;
    const currDiv = document.getElementById('curr_category');
    currDiv.innerHTML = `<h1>${category.name}</h1>`;

    const productsDiv = document.getElementById('products');
    productsDiv.innerHTML = ''; // Clear previous content
  
    // Loop through the products data and create HTML elements
    for (const product of products) {
      const productDiv = document.createElement('div');
      productDiv.className = 'product';
      productDiv.innerHTML = `<img src="${product.image}" alt="${product.name}" class="productImage">
                              <h3>${product.name}</h3>`;
    const addToCartDiv = document.createElement('div');
    addToCartDiv.className = 'addToCart';
    addToCartDiv.innerHTML = `<img src="images/cart.jpg" alt="Cart" id=${product.id}>
                                <p></p>`;
        const retrievedDataString = localStorage.getItem('dataString');
        const retrievedData = JSON.parse(retrievedDataString);
        
        // Update the count of the corresponding product in the retrieved data
        console.log(product.id);
        const item = retrievedData.categories.reduce((acc, category) => {
            return acc.concat(category.products);
        }, []).find(item => item.id == product.id);
        console.log(item);

        if (item.cnt > 0) {
            const pElement = addToCartDiv.querySelector('p'); // Get the <p> element within addToCartDiv
        // Change the content of the <p> element
        pElement.textContent = item.cnt;
        }

    addToCartDiv.addEventListener('click', () => {
        const retrievedDataString = localStorage.getItem('dataString');
        const retrievedData = JSON.parse(retrievedDataString);
        
        // Update the count of the corresponding product in the retrieved data
        const productId = addToCartDiv.querySelector('img').id; // Retrieve id from img element
        const item = retrievedData.categories.reduce((acc, category) => {
            return acc.concat(category.products);
        }, []).find(item => item.id == productId);
        
        item.cnt++;
        const pElement = addToCartDiv.querySelector('p'); // Get the <p> element within addToCartDiv
        // Change the content of the <p> element
        pElement.textContent = item.cnt;

        var retrievedCount = JSON.parse(localStorage.getItem('totalCntString'));
        retrievedCount++;
        console.log(retrievedCount);
        displayCartCount(retrievedCount);

        localStorage.setItem('totalCntString', JSON.stringify(retrievedCount));
        localStorage.setItem('dataString', JSON.stringify(retrievedData));
    });
      productDiv.appendChild(addToCartDiv);
      productsDiv.appendChild(productDiv);
    }
  }
  function displayCartCount(i) {
    var count = document.getElementById('totalCount');
    count.className = 'totalCount';
    if (i>0) {
        count.innerHTML = `<p>${i}</p>`;
        count.style.opacity = 1;
    } else {
        count.style.opacity = 0;
    }
  }

  if (localStorage.length === 0) {
    localStorage.setItem("dataString", JSON.stringify(data))
    localStorage.setItem("totalCntString", JSON.stringify(0))
  }
  var retrievedCount = JSON.parse(localStorage.getItem('totalCntString'));
    displayCartCount(retrievedCount);
  displayProducts(data.categories[0].products, data.categories[0]);
  displayCategories();